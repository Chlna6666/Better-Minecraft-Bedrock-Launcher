/* MusicPlayer.css - Auto Expand & Overflow Protection */

/* --- 基础容器 --- */
.mp-navbar-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    height: 36px;
    z-index: 1002;
    margin-right: 8px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    user-select: none;
}

/* =========================================
   1. 迷你胶囊 (Mini Capsule)
   ========================================= */
.mp-mini-capsule {
    display: flex;
    align-items: center;

    /* [默认/小屏状态]：强制收缩，防止溢出 */
    width: 36px;
    height: 36px;
    padding: 0 0 0 7px; /* 视觉居中碟片 */
    border-radius: 50%;
    gap: 0;

    /* 深色模式背景 */
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.1);

    cursor: pointer;
    color: #fff;
    box-sizing: border-box;
    overflow: hidden;

    /* 动画过渡 */
    transition:
            width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1),
            padding 0.5s cubic-bezier(0.34, 1.56, 0.64, 1),
            border-radius 0.4s ease,
            background 0.3s ease,
            gap 0.4s ease,
            box-shadow 0.3s ease;
}

/* [浅色模式] 胶囊基础色 */
[data-theme='light'] .mp-mini-capsule {
    background: rgba(255, 255, 255, 0.75);
    border-color: rgba(0, 0, 0, 0.08);
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    color: #333;
}

/* --- 胶囊内部元素 (默认隐藏/收缩) --- */
.mp-mini-disc { width: 20px; height: 20px; flex-shrink: 0; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center; }
.mp-mini-disc.rotating { animation: rotate 6s linear infinite; }
.mp-mini-cover { width: 100%; height: 100%; object-fit: cover; }

/* 默认隐藏文字和按钮，防止小屏溢出 */
.mp-mini-text-area {
    flex: 1; overflow: hidden; font-size: 0.8rem; font-weight: 600; white-space: nowrap;
    opacity: 0; transform: translateX(-10px); transition: opacity 0.3s ease, transform 0.3s ease;
    pointer-events: none;
}

.mp-mini-btn {
    width: 24px; height: 24px; border-radius: 50%; border: none; background: #ffffff; color: #000000;
    display: flex; align-items: center; justify-content: center; cursor: pointer;
    opacity: 0; transform: scale(0.5); transition: all 0.3s ease;
    pointer-events: none; flex-shrink: 0;
}
[data-theme='light'] .mp-mini-btn { background: #333333; color: #ffffff; }


@media (min-width: 1210px) {
    .mp-mini-capsule {
        width: 220px;
        border-radius: 20px;
        padding: 4px 6px 4px 10px;
        gap: 8px;
        /* 大屏下的背景色稍微亮一点 */
        background: rgba(255, 255, 255, 0.15);
    }

    [data-theme='light'] .mp-mini-capsule {
        background: rgba(255, 255, 255, 0.95);
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    /* 显形文字和按钮 */
    .mp-mini-text-area {
        opacity: 1; transform: translateX(0); pointer-events: auto;
    }
    .mp-mini-btn {
        opacity: 1; transform: scale(1); pointer-events: auto;
    }
}

/* =========================================
   2. 下拉卡片 (Widget) - 亚克力风格
   ========================================= */
.mp-dropdown-card {
    position: absolute;
    top: 48px;
    right: 0;
    width: 350px;
    height: 150px;
    border-radius: 20px;

    /* 深色模式：红铜色亚克力 */
    background: linear-gradient(135deg, rgba(142, 94, 54, 0.85) 0%, rgba(92, 58, 33, 0.85) 100%);
    backdrop-filter: blur(25px) saturate(180%);
    -webkit-backdrop-filter: blur(25px) saturate(180%);

    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.15);

    display: flex; align-items: center; padding: 14px; gap: 14px;

    transform-origin: top right;
    z-index: 2000;
    opacity: 0;
    transform: scale(0.9) translateY(-10px);
    pointer-events: none;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    overflow: hidden;
    color: #fff;
}

/* [浅色模式] 桃色亚克力 */
[data-theme='light'] .mp-dropdown-card {
    background: linear-gradient(135deg, rgba(255, 218, 185, 0.9) 0%, rgba(255, 183, 159, 0.9) 100%);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.6);
    color: #4a3b32; /* 深色文字 */
}

.mp-dropdown-card.visible { opacity: 1; transform: scale(1) translateY(0); pointer-events: auto; }

/* 封面 */
.card-cover-section {
    width: 112px; height: 112px; flex-shrink: 0; border-radius: 10px; overflow: hidden;
    box-shadow: 0 6px 16px rgba(0,0,0,0.25); background: rgba(0,0,0,0.2); position: relative;
}
.card-cover-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
.card-cover-img:hover { transform: scale(1.05); }

/* 信息区 */
.card-info-section {
    flex: 1; display: flex; flex-direction: column; justify-content: space-between;
    height: 100%; min-width: 0; padding: 2px 0;
}
.card-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
.card-context-text { font-size: 0.65rem; font-weight: 600; opacity: 0.7; text-transform: uppercase; letter-spacing: 0.5px; }
.card-track-count { font-size: 0.65rem; opacity: 0.6; }

/* 标题行 (滚动容器) */
.card-title-row { position: relative; height: 24px; margin-bottom: 8px; width: 100%; overflow: hidden; }
.card-title-text { font-size: 1.1rem; font-weight: 700; line-height: 1.2; white-space: nowrap; }

.mp-scroll-container { width: 100%; overflow: hidden; mask-image: linear-gradient(90deg, transparent 0%, #000 5%, #000 95%, transparent 100%); }
.mp-scroll-inner { display: flex; width: max-content; animation: marquee 8s linear infinite; }
.mp-scroll-inner span { padding-right: 20px; }

/* 进度条 */
.card-progress-row {
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.progress-track { width: 100%; height: 3px; background: rgba(255, 255, 255, 0.3); border-radius: 2px; position: relative; cursor: pointer; }
[data-theme='light'] .progress-track { background: rgba(0, 0, 0, 0.1); }
.progress-input { position: absolute; top: -6px; left: 0; width: 100%; height: 16px; opacity: 0; cursor: pointer; z-index: 2; margin: 0; }
.progress-fill { height: 100%; background: #fff; border-radius: 2px; position: relative; pointer-events: none; }
[data-theme='light'] .progress-fill { background: #4a3b32; }
.progress-handle {
    position: absolute; right: -4px; top: 50%; transform: translateY(-50%) scale(0);
    width: 8px; height: 8px; background: #fff; border-radius: 50%; transition: transform 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.3);
}
[data-theme='light'] .progress-handle { background: #4a3b32; }
.progress-track:hover .progress-handle, .progress-input:active + .progress-fill .progress-handle { transform: translateY(-50%) scale(1); }
.time-labels { display: flex; justify-content: space-between; font-size: 0.6rem; font-family: monospace; font-weight: 600; opacity: 0.6; }

/* 底部按钮 */
.card-controls-row { display: flex; align-items: center; justify-content: space-between; }
.ctrl-btn {
    background: transparent; border: none; color: inherit; opacity: 0.7; cursor: pointer;
    transition: all 0.2s; display: flex; align-items: center; justify-content: center; padding: 4px; border-radius: 50%;
}
.ctrl-btn:hover { opacity: 1; background: rgba(255,255,255,0.1); }
[data-theme='light'] .ctrl-btn:hover { background: rgba(0,0,0,0.05); }
.ctrl-btn.active { opacity: 1; background: rgba(255,255,255,0.2); font-weight: bold; }

.play-btn-large {
    width: 34px; height: 34px; background: #fff; color: #5C3A21; border-radius: 50%; border: none;
    display: flex; align-items: center; justify-content: center; cursor: pointer;
    box-shadow: 0 3px 8px rgba(0,0,0,0.2); transition: transform 0.15s;
}
[data-theme='light'] .play-btn-large { background: #4a3b32; color: #FFDAB9; }
.play-btn-large:hover { transform: scale(1.1); }
.play-btn-large:active { transform: scale(0.95); }

/* =========================================
   3. 音量调节 (自动变色药丸)
   ========================================= */
.volume-wrapper { position: relative; z-index: 10; }

/* 弹窗容器 */
.vol-popup {
    position: absolute;
    bottom: 120%;
    left: 50%;
    transform: translateX(-50%);

    /* 深色模式背景 */
    background: rgba(30, 30, 30, 0.6);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);

    width: 36px;
    height: 100px;
    padding: 0;
    border-radius: 18px;
    border: none;
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);

    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s, bottom 0.2s;

    display: flex;
    justify-content: center;
    align-items: center;

    /* [变量] 深色模式：填充白 */
    --vol-fill: #ffffff;
    --vol-bg: rgba(255, 255, 255, 0.2);
}

/* [浅色模式] 变量重写 */
[data-theme='light'] .vol-popup {
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);

    /* [变量] 浅色模式：填充深棕 */
    --vol-fill: #4a3b32;
    --vol-bg: rgba(0, 0, 0, 0.1);
}

/* 透明桥梁 */
.vol-popup::after {
    content: ''; position: absolute; bottom: -20px; left: -10px; right: -10px; height: 30px; background: transparent; z-index: -1;
}

.volume-wrapper:hover .vol-popup, .vol-popup:hover { opacity: 1; bottom: 110%; pointer-events: auto; }

/* 音量滑块 */
.vol-range-v {
    transform: rotate(-90deg);
    transform-origin: center;
    width: 80px;
    height: 12px;

    -webkit-appearance: none;
    appearance: none;

    /* [CSS 变量驱动] 背景色由 React 传递的 --progress 决定 */
    --progress: 0%;
    background: linear-gradient(to right, var(--vol-fill) var(--progress), var(--vol-bg) var(--progress));

    border-radius: 10px;
    cursor: pointer;
    outline: none;
}

.vol-range-v::-webkit-slider-runnable-track { width: 100%; height: 100%; background: transparent; }
.vol-range-v::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; height: 0; width: 0; }

/* 动画 */
@keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }